<% layout('layouts/boilerplate') %>

<div class="container mt-4">
  <div class="row">
    <div class="col-12">
      <div class="card shadow mb-4">
        <div
          class="card-header bg-primary text-white d-flex justify-content-between align-items-center"
        >
          <h2 class="mb-0">Admin Dashboard</h2>
          <a href="/admin/logout" class="btn btn-light">Logout</a>
        </div>
        <div class="card-body">
          <h4>Welcome, <%= currentUser.username %></h4>
          <p>You are logged in as an administrator.</p>
        </div>
      </div>

      <div class="card shadow">
        <div class="card-header bg-secondary text-white">
          <h3 class="mb-0">Feedback Management</h3>
        </div>
        <div class="card-body">
          <% if(typeof feedbacks !== 'undefined' && feedbacks.length) { %>
          <div class="table-responsive">
            <table class="table table-striped">
              <thead>
                <tr>
                  <th>User</th>
                  <th>Title</th>
                  <th>Rating</th>
                  <th>Status</th>
                  <th>Date</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                <% feedbacks.forEach(feedback => { %>
                <tr>
                  <td>
                    <%= feedback.author ? feedback.author.username : 'Unknown'
                    %>
                  </td>
                  <td><%= feedback.title %></td>
                  <td><%= feedback.rating %>/5</td>
                  <td>
                    <span
                      class="badge <%= feedback.status === 'open' ? 'bg-success' : feedback.status === 'in-progress' ? 'bg-warning' : 'bg-danger' %>"
                    >
                      <%= feedback.status || 'Open' %>
                    </span>
                  </td>
                  <td><%= feedback.createdAt.toLocaleDateString() %></td>
                  <td>
                    <a
                      href="/feedback/<%= feedback._id %>"
                      class="btn btn-sm btn-info"
                      >View</a
                    >
                    <form
                      class="d-inline"
                      action="/feedback/<%= feedback._id %>?_method=DELETE"
                      method="POST"
                    >
                      <button class="btn btn-sm btn-danger">Delete</button>
                    </form>
                  </td>
                </tr>
                <% }); %>
              </tbody>
            </table>
          </div>
          <% } else { %>
          <div class="alert alert-info">No feedback submissions yet.</div>
          <% } %>
        </div>
      </div>
    </div>
  </div>
</div>
